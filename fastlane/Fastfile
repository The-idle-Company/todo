require 'base64' # Add this require

default_platform(:ios)

platform :ios do
  lane :upload_ipa_to_testflight_app_store_connect do
    api_key = {
      key_id: ENV["APP_STORE_CONNECT_API_KEY_ID"],
      issuer_id: ENV["APP_STORE_CONNECT_API_KEY_ISSUER_ID"],
      key: Base64.decode64(ENV["APP_STORE_CONNECT_API_KEY"]), # Decode the base64 string
      is_key_content_base64: true # Important: Set this to true
    }

    latest_build = latest_testflight_build_number(
      app_identifier: "com.test.todo.kehinde",
      api_key: api_key,
      version: "1.0.1"
    )

    puts "Latest Build Number: #{latest_build}"
  end
end